!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("i18next-locize-backend",t):e.i18next-locize-backend=t()}(this,function(){"use strict";function e(e,t,n){var o;return function(){var i=this,r=arguments,a=function(){o=null,n||e.apply(i,r)},s=n&&!o;clearTimeout(o),o=setTimeout(a,t),s&&e.apply(i,r)}}function t(e,t,n){function o(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}for(var i="string"!=typeof t?[].concat(t):t.split(".");i.length>1;){if(!e)return{};var r=o(i.shift());!e[r]&&n&&(e[r]=new n),e=e[r]}return e?{obj:e,k:o(i.shift())}:{}}function n(e,n,o){var i=t(e,n,Object),r=i.obj,a=i.k;r[a]=o}function o(e,n,o,i){var r=t(e,n,Object),a=r.obj,s=r.k;a[s]=a[s]||[],i&&(a[s]=a[s].concat(o)),i||a[s].push(o)}function i(e,n){var o=t(e,n),i=o.obj,r=o.k;return i?i[r]:void 0}function r(e,t,n,o,i){if(o&&"object"===("undefined"==typeof o?"undefined":s["typeof"](o))){var r="",a=encodeURIComponent;for(var c in o)r+="&"+a(c)+"="+a(o[c]);o=r.slice(1)+(i?"":"&_t="+new Date)}try{var u=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");u.open(o?"POST":"GET",e,1),t.crossDomain||u.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.authorize&&t.apiKey&&u.setRequestHeader("Authorization",t.apiKey),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){u.readyState>3&&n&&n(u.responseText,u)},u.send(o)}catch(a){window.console&&console.log(a)}}function a(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"locales/add/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,version:"latest"}}var s={};s["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s["extends"]=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};var c=function(){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];s.classCallCheck(this,t),this.init(e,n),this.type="backend"}return s.createClass(t,[{key:"init",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.services=t,this.options=s["extends"]({},a(),this.options,n),this.queuedWrites={},this.debouncedWrite=e(this.write,1e4)}},{key:"read",value:function(e,t,n){var o=this.services.interpolator.interpolate(this.options.loadPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version});this.loadUrl(o,n)}},{key:"loadUrl",value:function(e,t){r(e,this.options,function(n,o){var i=o.status.toString();if(0===i.indexOf("5"))return t("failed loading "+e,!0);if(0===i.indexOf("4"))return t("failed loading "+e,!1);var r=void 0,a=void 0;try{r=JSON.parse(n)}catch(s){a="failed parsing "+e+" to json"}return a?t(a,!1):void t(null,r)})}},{key:"create",value:function(e,t,n,o,i){var r=this;i||(i=function(){}),"string"==typeof e&&(e=[e]),e.forEach(function(e){e===r.options.referenceLng&&r.queue.call(r,r.options.referenceLng,t,n,o,i)})}},{key:"write",value:function(e,t){var o=this,a=i(this.queuedWrites,["locks",e,t]);if(!a){var c=this.services.interpolator.interpolate(this.options.addPath,{lng:e,ns:t,projectId:this.options.projectId,version:this.options.version}),u=i(this.queuedWrites,[e,t]);n(this.queuedWrites,[e,t],[]),u.length&&!function(){n(o.queuedWrites,["locks",e,t],!0);var i={};u.forEach(function(e){i[e.key]=e.fallbackValue||""}),r(c,s["extends"]({authorize:!0},o.options),function(i,r){n(o.queuedWrites,["locks",e,t],!1),u.forEach(function(e){e.callback&&e.callback()}),o.debouncedWrite(e,t)},i)}()}}},{key:"queue",value:function(e,t,n,i,r){o(this.queuedWrites,[e,t],{key:n,fallbackValue:i||"",callback:r}),this.debouncedWrite(e,t)}}]),t}();return c.type="backend",c});